#!/bin/bash

DDCUTIL="${DDCUTIL:-ddcutil}"
VCP=10
DEV_OPT=""
[[ -n "$MONITOR_DEV" ]] && DEV_OPT="-d $MONITOR_DEV"

case "$1" in
  get)
    $DDCUTIL getvcp $VCP $DEV_OPT 2>/dev/null | \
      awk '/Brightness/ {gsub(/,/, "", $9); print $9}'
    ;;
  set)
    val=${2:-50}
    ((val < 0)) && val=0
    ((val > 100)) && val=100
    $DDCUTIL setvcp $VCP $val $DEV_OPT 2>/dev/null
    ;;
  incr)
    $DDCUTIL setvcp $VCP +${2:-5} $DEV_OPT 2>/dev/null
    ;;
  decr)
    $DDCUTIL setvcp $VCP -${2:-5} $DEV_OPT 2>/dev/null
    ;;
  *)
    echo "Usage: $0 [get|set <val>|incr <step>|decr <step>]" >&2
    exit 1
    ;;
esac
